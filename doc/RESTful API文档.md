
# **ğŸ“Œ RESTful API æ–‡æ¡£**

## **1. æ•°æ®åº“æ“ä½œ APIï¼ˆDatabaseï¼‰**

- **æ¥å£åœ°å€**ï¼š`http://<ip>:<port>/api/database`
- **è¯·æ±‚æ–¹å¼**ï¼š`POST`
- **è¯·æ±‚æ ¼å¼**ï¼š`application/json`
- **è¿”å›æ ¼å¼**ï¼š`application/json`
- **æ¥å£åŠŸèƒ½**ï¼šæä¾› **æŸ¥è¯¢ï¼ˆSelectï¼‰** æ“ä½œï¼Œæ”¯æŒ **æ¡ä»¶ç­›é€‰ã€æ’åºã€åˆ†é¡µ**ã€‚

### **1.1 è¯·æ±‚å‚æ•°**

#### **1.1.1 å…¬å…±å‚æ•°**

| å‚æ•°         | ç±»å‹     | æ˜¯å¦å¿…å¡« | è¯´æ˜                      |
| ------------ | -------- | -------- | ------------------------- |
| `method`     | `string` | âœ… æ˜¯     | æ“ä½œç±»å‹ï¼Œå›ºå®šä¸º `select` |
| `table`      | `string` | âœ… æ˜¯     | ç›®æ ‡æ•°æ®åº“è¡¨å            |
| `filters`    | `array`  | âŒ å¦     | æŸ¥è¯¢æ—¶çš„ç­›é€‰æ¡ä»¶          |
| `sort`       | `object` | âŒ å¦     | æŸ¥è¯¢æ—¶çš„æ’åºå­—æ®µ          |
| `pagination` | `object` | âŒ å¦     | æŸ¥è¯¢æ—¶çš„åˆ†é¡µå‚æ•°          |

#### **1.1.2 `filters` ç»“æ„**

ç”¨äº `select` æ“ä½œï¼Œæ”¯æŒ `AND` é€»è¾‘æŸ¥è¯¢ã€‚

| å‚æ•°       | ç±»å‹     | æ˜¯å¦å¿…å¡« | è¯´æ˜                                                         |
| ---------- | -------- | -------- | ------------------------------------------------------------ |
| `field`    | `string` | âœ… æ˜¯     | éœ€è¦ç­›é€‰çš„å­—æ®µå                                             |
| `value`    | `any`    | âœ… æ˜¯     | è¿‡æ»¤æ¡ä»¶çš„å€¼                                                 |
| `operator` | `string` | âœ… æ˜¯     | é€»è¾‘è¿ç®—ç¬¦ï¼Œæ”¯æŒï¼š`=`ã€`!=`ã€`>`ã€`>=`ã€`<`ã€`<=`            |
| `logic`    | `string` | âŒ å¦     | é€»è¾‘è¿ç®—ç¬¦ï¼Œæ”¯æŒï¼šANDï¼ˆé»˜è®¤ï¼‰å’Œ ORï¼Œå½±å“ç›¸é‚»åä¸€æ¡è¿‡æ»¤ä¿¡æ¯ã€‚ |

#### **1.1.3 `sort` ç»“æ„**

ç”¨äº `select` æ“ä½œï¼Œæ”¯æŒæ’åºè§„åˆ™ã€‚

| å‚æ•°    | ç±»å‹     | æ˜¯å¦å¿…å¡« | è¯´æ˜                                          |
| ------- | -------- | -------- | --------------------------------------------- |
| `field` | `string` | âœ… æ˜¯     | éœ€è¦æ’åºçš„å­—æ®µå                              |
| `order` | `string` | âœ… æ˜¯     | æ’åºæ–¹å¼ï¼Œå¯é€‰ï¼š`asc`ï¼ˆå‡åºï¼‰ã€`desc`ï¼ˆé™åºï¼‰ |

#### **1.1.4 `pagination` ç»“æ„**

ç”¨äº `select` æ“ä½œï¼Œæ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼Œé¿å…è¿”å›è¿‡å¤šæ•°æ®å½±å“æ€§èƒ½ã€‚

| å‚æ•°     | ç±»å‹  | æ˜¯å¦å¿…å¡« | è¯´æ˜                                                                       |
| -------- | ----- | -------- | -------------------------------------------------------------------------- |
| `limit`  | `int` | âœ… æ˜¯     | æ¯é¡µè¿”å›çš„æœ€å¤§è®°å½•æ•°ï¼Œä¾‹å¦‚ `10` è¡¨ç¤ºæ¯æ¬¡æœ€å¤šè¿”å› 10 æ¡æ•°æ®                 |
| `offset` | `int` | âœ… æ˜¯     | éœ€è¦è·³è¿‡çš„è®°å½•æ•°ï¼Œä¾‹å¦‚ `0` è¡¨ç¤ºä»ç¬¬ä¸€æ¡æ•°æ®å¼€å§‹ï¼Œ`10` è¡¨ç¤ºè·³è¿‡å‰ 10 æ¡æ•°æ® |

---

### **1.2 ä½¿ç”¨ç¤ºä¾‹**

#### **1.2.1 æŸ¥è¯¢æ•°æ®ï¼ˆSelectï¼‰**

**è¯·æ±‚**
```json
{
    "method": "select",
    "table": "users",
    "filters": [
        {
            "field": "age",
            "value": 30,
            "operator": ">",
            "logic": "OR" //å½±å“ç›¸é‚»åä¸€æ¡è¿‡æ»¤ä¿¡æ¯ã€‚
        },
        {
            "field": "name",
            "value": "Alice",
            "operator": "="
        }
    ],
    "pagination": {
        "limit": 10,
        "offset": 0
    },
    "sort": {
        "field": "name",
        "order": "asc"
    }
}
```

**è¿”å›**
```json
{
    "status": "success",
    "code": 200,
    "data": [
        {
            "name": "Alice",
            "age": 30,
            "email": "alice@example.com"
        }
    ]
}
```

---

## **2. æ¶ˆæ¯é€šä¿¡ APIï¼ˆCommunicationï¼‰**

- **æ¥å£åœ°å€**ï¼š`http://<ip>:<port>/api/communication`
- **è¯·æ±‚æ–¹å¼**ï¼š`POST`
- **è¯·æ±‚æ ¼å¼**ï¼š`application/json`
- **è¿”å›æ ¼å¼**ï¼š`application/json`
- **æ¥å£åŠŸèƒ½**ï¼šå®ç°ä¸åŒç³»ç»Ÿä¹‹é—´çš„æ•°æ®é€šä¿¡ã€‚

### **2.1 è¯·æ±‚å‚æ•°**

| å‚æ•°       | ç±»å‹     | æ˜¯å¦å¿…å¡« | è¯´æ˜                                               |
| ---------- | -------- | -------- | -------------------------------------------------- |
| `consumer` | `string` | âœ… æ˜¯     | é€šä¿¡ç›®æ ‡ï¼Œå¯é€‰ï¼š`shidai`ã€`tangche`                |
| `type`     | `string` | âœ… æ˜¯     | æ•°æ®ç±»å‹ï¼Œå¯é€‰ï¼š`realtime`ã€`file`ã€`ç½‘æ£€`ã€`ç½‘å·¡` |
| `data`     | `object` | âœ… æ˜¯     | ä¼ è¾“çš„æ•°æ®å†…å®¹                                     |

#### **2.1.1 `data` ç»“æ„**

| å‚æ•°        | ç±»å‹     | æ˜¯å¦å¿…å¡« | è¯´æ˜           |
| ----------- | -------- | -------- | -------------- |
| `msg`       | `string` | âŒ å¦     | å½“å‰æ­£æ–‡       |
| `file_path` | `string` | âŒ å¦     | å¯é€‰ï¼Œæ–‡ä»¶è·¯å¾„ |

---

### **2.2 ä½¿ç”¨ç¤ºä¾‹**

#### **2.2.1 å‘é€å®æ—¶æ¶ˆæ¯ï¼ˆRealtimeï¼‰**

**è¯·æ±‚**
```json
{
    "consumer": "shidai",
    "type": "realtime",
    "data": {
        "msg": "This is a real-time message."
    }
}
```

**è¿”å›**
```json
{
    "status": "success",
    "code": 200,
    "message": "Message sent successfully"
}
```

---

#### **2.2.2 å‘é€æ–‡ä»¶æ¶ˆæ¯ï¼ˆFileï¼‰**

**è¯·æ±‚**
```json
{
    "consumer": "tangche",
    "type": "file",
    "data": {
        "file_path": "/path/to/file.txt"
    }
}
```

**è¿”å›**
```json
{
    "status": "success",
    "code": 200,
    "message": "File sent successfully"
}
```

---

## **3. TCP è®¢é˜…æ¨é€æœåŠ¡ APIï¼ˆSubscription & Pushï¼‰**

- **æœåŠ¡å™¨åœ°å€**ï¼š`tcp://<ip>:<port>`
- **è¯·æ±‚æ–¹å¼**ï¼šTCP è¿æ¥
- **æ•°æ®æ ¼å¼**ï¼š  
  - **è¯·æ±‚**ï¼š`{[(tcp_header)]}int64è¯·æ±‚æ­£æ–‡{[(tcp_tail)]}`
  - **æ¨é€**ï¼š`{[(tcp_header)]}int64æ¨é€æ­£æ–‡{[(tcp_tail)]}`

#### **3.1 è®¢é˜…æ“ä½œ**

**è¯·æ±‚**
```json
{
    "type": "subscribe",
    "category": "task",
    "data": {
        "msg": "æ¥æ”¶ä»»åŠ¡é€šçŸ¥"
    }
}
```

**è¿”å›**
```json
{
    "status": "success",
    "code": 200,
    "message": "Subscribed to task notifications"
}
```

---

#### **3.2 å–æ¶ˆè®¢é˜…**

**è¯·æ±‚**
```json
{
    "type": "unsubscribe",
    "category": "task",
    "data": {
        "msg": "å–æ¶ˆä»»åŠ¡é€šçŸ¥"
    }
}
```

**è¿”å›**
```json
{
    "status": "success",
    "code": 200,
    "message": "Unsubscribed from task notifications"
}
```

---

#### **3.3 å‘å¸ƒæ¶ˆæ¯**

**è¯·æ±‚**
```json
{
    "type": "publish",
    "category": "task",
    "data": {
        "msg": "æ–°çš„ä»»åŠ¡å‘å¸ƒ"
    }
}
```

**è¿”å›**
```json
{
    "status": "success",
    "code": 200,
    "message": "Message published successfully"
}
```

---
